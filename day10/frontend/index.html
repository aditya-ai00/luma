<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="UTF-8">
<html lang="en">

<!DOCTYPE html>
<html>
<head>
<title>Improv Battle â€“ Voice Game</title>
<style>
body { font-family:Poppins;background:#222;display:flex;justify-content:center;padding-top:40px;color:white; }
.card { width:480px;background:#111;padding:20px;border-radius:16px;box-shadow:0 0 20px rgba(255,0,0,0.4); }
.chat { height:320px;overflow-y:auto;background:#1c1c1c;border-radius:12px;padding:10px;margin-bottom:10px; }
.bubble { padding:8px 11px;border-radius:10px;margin:6px 0;max-width:85%; }
.user { background:#ff005c;margin-left:auto; }
.bot { background:#2e2e2e; }
input,button { width:100%;padding:11px;border-radius:8px;margin-top:8px;border:none;font-size:15px; }
button { background:#ff005c;font-weight:600;cursor:pointer; }
audio { width:100%;margin-top:8px; }
</style>
</head>

<body>
<div class="card">
<h2>ðŸŽ¤ Improv Battle</h2>
<div id="chat" class="chat"></div>

<input id="text" placeholder="Type and press Enter..." />
<button onclick="sendText()">Send</button>

<audio id="player" controls></audio>
</div>

<script>
const API = "http://localhost:8000/api/improv";
const chat = document.getElementById("chat");
const input = document.getElementById("text");
const player = document.getElementById("player");

function add(msg, who) {
  const div = document.createElement("div");
  div.className = "bubble " + who;
  div.textContent = msg;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

async function sendText() {
  const text = input.value.trim();
  if (!text) return;
  add(text, "user");
  input.value = "";

  const r = await fetch(API, {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ text })
  });
  const j = await r.json();
  add(j.reply, "bot");
  if (j.audioUrl) { player.src = j.audioUrl; player.play().catch(()=>{}); }
}

input.addEventListener("keydown", e => { if (e.key === "Enter") sendText(); });
</script>
</body>
</html>
